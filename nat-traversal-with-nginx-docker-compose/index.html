<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="ä»‹ç»ç›®å‰æ‰‹ä¸­æœ‰ä¸‰å°NATåçš„è®¾å¤‡ï¼Œå…¶ä¸­ä¸€å°æœ‰å†…ç½‘ç©¿é€çš„éœ€æ±‚ï¼Œäºæ˜¯é€‰æ‹©frpä½œä¸ºå†…ç½‘ç©¿é€å·¥å…·ï¼Œä»¥ä¾¿å¦å¤–ä¸¤å°è®¾å¤‡åœ¨å¤–ç½‘è®¿é—®ã€‚ä½¿ç”¨nginxå¯¹å†…ç½‘ç©¿é€çš„æµé‡è¿›è¡Œè½¬å‘å’Œè¿‡æ»¤æ»¡è¶³å®‰å…¨éœ€æ±‚ï¼Œä½¿ç”¨docker-composeå¯¹nginxå’ŒfrpæœåŠ¡è¿›è¡Œç¼–æ’ã€‚ ğŸ“é¡¹ç›®åœ°å€ æ‹“æ‰‘ç»“æ„å› ä¸ºåªæœ‰ä¸€å°è®¾å¤‡ï¼Œæ‰€ä»¥æ‹“æ‰‘ç»“æ„éå¸¸ç®€å•ï¼Œå¦‚ä¸‹å¯¹å†…ç½‘æœåŠ¡å™¨æä¾›çš„80å’Œ81æœåŠ¡è¿›è¡Œè½¬å‘ã€‚  frpæœåŠ¡é…ç½®frp is a fast">
<meta property="og:type" content="article">
<meta property="og:title" content="ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡">
<meta property="og:url" content="https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/">
<meta property="og:site_name" content="Focuseds Blog">
<meta property="og:description" content="ä»‹ç»ç›®å‰æ‰‹ä¸­æœ‰ä¸‰å°NATåçš„è®¾å¤‡ï¼Œå…¶ä¸­ä¸€å°æœ‰å†…ç½‘ç©¿é€çš„éœ€æ±‚ï¼Œäºæ˜¯é€‰æ‹©frpä½œä¸ºå†…ç½‘ç©¿é€å·¥å…·ï¼Œä»¥ä¾¿å¦å¤–ä¸¤å°è®¾å¤‡åœ¨å¤–ç½‘è®¿é—®ã€‚ä½¿ç”¨nginxå¯¹å†…ç½‘ç©¿é€çš„æµé‡è¿›è¡Œè½¬å‘å’Œè¿‡æ»¤æ»¡è¶³å®‰å…¨éœ€æ±‚ï¼Œä½¿ç”¨docker-composeå¯¹nginxå’ŒfrpæœåŠ¡è¿›è¡Œç¼–æ’ã€‚ ğŸ“é¡¹ç›®åœ°å€ æ‹“æ‰‘ç»“æ„å› ä¸ºåªæœ‰ä¸€å°è®¾å¤‡ï¼Œæ‰€ä»¥æ‹“æ‰‘ç»“æ„éå¸¸ç®€å•ï¼Œå¦‚ä¸‹å¯¹å†…ç½‘æœåŠ¡å™¨æä¾›çš„80å’Œ81æœåŠ¡è¿›è¡Œè½¬å‘ã€‚  frpæœåŠ¡é…ç½®frp is a fast">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/focuseds/pics/main/img/202209-topological-structure-1">
<meta property="og:image" content="https://raw.githubusercontent.com/focuseds/pics/main/img/202209-topological-structure-with-docker-compose.png">
<meta property="og:image" content="https://raw.githubusercontent.com/focuseds/pics/main/img/nat-project-running-example.png">
<meta property="article:published_time" content="2022-09-01T03:22:04.000Z">
<meta property="article:modified_time" content="2022-09-06T08:44:19.498Z">
<meta property="article:author" content="Focuseds">
<meta property="article:tag" content="nginx">
<meta property="article:tag" content="docker">
<meta property="article:tag" content="å†…ç½‘ç©¿é€">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/focuseds/pics/main/img/202209-topological-structure-1">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.2.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="ç›®å½•"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="ç›®å½•"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="é¡¶éƒ¨" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">é¦–é¡µ</a></li><!--
     --><!--
       --><li><a href="/archives/">å½’æ¡£</a></li><!--
     --><!--
       --><li><a href="/search/">æœç´¢</a></li><!--
     --><!--
       --><li><a href="/about/">å…³äº</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="ä¸Šä¸€ç¯‡" href="/tiny-blog-system-based-on-OSS-n-FC/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="ä¸‹ä¸€ç¯‡" href="/yuque/CPP%E7%AE%80%E7%AD%94%E6%B1%87%E6%80%BB/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="è¿”å›é¡¶éƒ¨" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="åˆ†äº«æ–‡ç« " href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">ä¸Šä¸€ç¯‡</span>
      <span id="i-next" class="info" style="display:none;">ä¸‹ä¸€ç¯‡</span>
      <span id="i-top" class="info" style="display:none;">è¿”å›é¡¶éƒ¨</span>
      <span id="i-share" class="info" style="display:none;">åˆ†äº«æ–‡ç« </span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/&text=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/&title=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/&is_video=false&description=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡&body=Check out this article: https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/&title=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/&title=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/&title=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/&title=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/&name=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/&t=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">ä»‹ç»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E7%BB%93%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">æ‹“æ‰‘ç»“æ„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#frp%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE"><span class="toc-number">3.</span> <span class="toc-text">frpæœåŠ¡é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#frp%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">3.1.</span> <span class="toc-text">frpæœåŠ¡ç«¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#frpc"><span class="toc-number">3.2.</span> <span class="toc-text">frpc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E9%9C%80%E6%B1%82"><span class="toc-number">3.3.</span> <span class="toc-text">å®‰å…¨éœ€æ±‚</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Token%E8%AE%A4%E8%AF%81"><span class="toc-number">3.3.1.</span> <span class="toc-text">Tokenè®¤è¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OIDC%E8%AE%A4%E8%AF%81"><span class="toc-number">3.3.2.</span> <span class="toc-text">OIDCè®¤è¯</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#frps%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8F%82%E8%80%83"><span class="toc-number">3.3.2.1.</span> <span class="toc-text">frpsé…ç½®æ–‡ä»¶å‚è€ƒ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#frpc%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8F%82%E8%80%83"><span class="toc-number">3.3.2.2.</span> <span class="toc-text">frpcé…ç½®æ–‡ä»¶å‚è€ƒ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="toc-number">3.3.2.3.</span> <span class="toc-text">å‚æ•°è¯´æ˜</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#frp%E4%B8%8B%E8%BD%BD"><span class="toc-number">3.4.</span> <span class="toc-text">frpä¸‹è½½</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92"><span class="toc-number">4.</span> <span class="toc-text">å®¹å™¨ç¼–æ’</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">4.1.</span> <span class="toc-text">æ–‡ä»¶ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-compose%E7%BC%96%E6%8E%92%E6%96%87%E4%BB%B6"><span class="toc-number">4.2.</span> <span class="toc-text">docker-composeç¼–æ’æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#frps%E5%AE%B9%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">4.3.</span> <span class="toc-text">frpså®¹å™¨é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">4.3.1.</span> <span class="toc-text">ç›®å½•ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Dockerfile"><span class="toc-number">4.3.2.</span> <span class="toc-text">Dockerfile</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nginx%E5%AE%B9%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">4.4.</span> <span class="toc-text">nginxå®¹å™¨é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84-1"><span class="toc-number">4.4.1.</span> <span class="toc-text">ç›®å½•ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E6%8E%92%E5%90%8E%E7%9A%84%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91"><span class="toc-number">4.4.2.</span> <span class="toc-text">ç¼–æ’åçš„ç½‘ç»œæ‹“æ‰‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">4.4.3.</span> <span class="toc-text">nginxé…ç½®æ–‡ä»¶</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#upstream%E9%85%8D%E7%BD%AE"><span class="toc-number">4.5.</span> <span class="toc-text">upstreamé…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dockerfile-1"><span class="toc-number">4.6.</span> <span class="toc-text">Dockerfile</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-number">5.</span> <span class="toc-text">ç»“è¯­</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-number">6.</span> <span class="toc-text">å‚è€ƒé“¾æ¥</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Focuseds</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-09-01T03:22:04.000Z" itemprop="datePublished">2022-09-01</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/docker/" rel="tag">docker</a>, <a class="tag-link-link" href="/tags/nginx/" rel="tag">nginx</a>, <a class="tag-link-link" href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" rel="tag">å†…ç½‘ç©¿é€</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>ç›®å‰æ‰‹ä¸­æœ‰ä¸‰å°<code>NAT</code>åçš„è®¾å¤‡ï¼Œå…¶ä¸­ä¸€å°æœ‰å†…ç½‘ç©¿é€çš„éœ€æ±‚ï¼Œäºæ˜¯é€‰æ‹©<code>frp</code>ä½œä¸ºå†…ç½‘ç©¿é€å·¥å…·ï¼Œä»¥ä¾¿å¦å¤–ä¸¤å°è®¾å¤‡åœ¨å¤–ç½‘è®¿é—®ã€‚ä½¿ç”¨<code>nginx</code>å¯¹å†…ç½‘ç©¿é€çš„æµé‡è¿›è¡Œè½¬å‘å’Œè¿‡æ»¤æ»¡è¶³å®‰å…¨éœ€æ±‚ï¼Œä½¿ç”¨<code>docker-compose</code>å¯¹<code>nginx</code>å’Œ<code>frp</code>æœåŠ¡è¿›è¡Œç¼–æ’ã€‚</p>
<p>ğŸ“<a target="_blank" rel="noopener" href="https://github.com/focuseds/NAT-traversal-server-with-nginx/">é¡¹ç›®åœ°å€</a></p>
<h2 id="æ‹“æ‰‘ç»“æ„"><a href="#æ‹“æ‰‘ç»“æ„" class="headerlink" title="æ‹“æ‰‘ç»“æ„"></a>æ‹“æ‰‘ç»“æ„</h2><p>å› ä¸ºåªæœ‰ä¸€å°è®¾å¤‡ï¼Œæ‰€ä»¥æ‹“æ‰‘ç»“æ„éå¸¸ç®€å•ï¼Œå¦‚ä¸‹å¯¹å†…ç½‘æœåŠ¡å™¨æä¾›çš„<code>80</code>å’Œ<code>81</code>æœåŠ¡è¿›è¡Œè½¬å‘ã€‚</p>
<p><img src="https://raw.githubusercontent.com/focuseds/pics/main/img/202209-topological-structure-1" alt="æ‹“æ‰‘ç»“æ„"></p>
<h2 id="frpæœåŠ¡é…ç½®"><a href="#frpæœåŠ¡é…ç½®" class="headerlink" title="frpæœåŠ¡é…ç½®"></a>frpæœåŠ¡é…ç½®</h2><p>frp is a fast reverse proxy to help you expose a local server behind a NAT or firewall to the Internet. As of now, it supports TCP and UDP, as well as HTTP and HTTPS protocols, where requests can be forwarded to internal services by domain name.</p>
<p>frp æ˜¯ä¸€ä¸ªä¸“æ³¨äºå†…ç½‘ç©¿é€çš„é«˜æ€§èƒ½çš„åå‘ä»£ç†åº”ç”¨ï¼Œæ”¯æŒ TCPã€UDPã€HTTPã€HTTPS ç­‰å¤šç§åè®®ã€‚å¯ä»¥å°†å†…ç½‘æœåŠ¡ä»¥å®‰å…¨ã€ä¾¿æ·çš„æ–¹å¼é€šè¿‡å…·æœ‰å…¬ç½‘ IP èŠ‚ç‚¹çš„ä¸­è½¬æš´éœ²åˆ°å…¬ç½‘ã€‚</p>
<h3 id="frpæœåŠ¡ç«¯"><a href="#frpæœåŠ¡ç«¯" class="headerlink" title="frpæœåŠ¡ç«¯"></a>frpæœåŠ¡ç«¯</h3><p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œå¯ä»¥é€šè¿‡é…ç½®<code>frps.ini</code>å¯¹æœåŠ¡ç«¯è¿›è¡Œé…ç½®ï¼Œæ¯”å¦‚æœåŠ¡ç«¯å£å’Œèº«ä»½è®¤è¯ï¼Œä¸‹é¢æ˜¯å¯ä»¥å‚è€ƒçš„åŸºç¡€é…ç½®ã€‚</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">token</span> = c4bf92d681</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢é…ç½®æ–‡ä»¶çš„<code>common</code>å—ä¸­é…ç½®äº†æœ€åŸºç¡€çš„æœåŠ¡ç«¯å£å’Œè®¤è¯å£ä»¤ï¼Œè®¤è¯å£ä»¤å¯ä»¥é˜²æ­¢æœåŠ¡è¢«æ¶æ„ä½¿ç”¨ã€‚è¿˜æœ‰æ›´å¤šåœ°é…ç½®é¡¹å¯ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="https://github.com/fatedier/frp">frpæ–‡æ¡£</a>ã€‚</p>
<h3 id="frpc"><a href="#frpc" class="headerlink" title="frpc"></a>frpc</h3><p>æ ¹æ®æˆ‘ä»¬çš„æ‹“æ‰‘å’ŒæœåŠ¡ç«¯é…ç½®ï¼Œå…¬ç½‘è½¬å‘æœåŠ¡å™¨IPä¸º<code>103.12.35.6</code>ï¼Œæ•…å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶å¯é…ç½®å¦‚ä¸‹ã€‚å®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶<code>frpc.ini</code>åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šæœåŠ¡ç«¯ä¿¡æ¯å’Œéœ€è¦è½¬å‘çš„ç«¯å£ä¿¡æ¯ã€‚</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> =  <span class="number">103.12</span>.<span class="number">35.6</span> <span class="comment">#æœåŠ¡å™¨åœ°å€</span></span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">token</span> = c4bf92d681</span><br><span class="line"></span><br><span class="line"><span class="section">[tcp_80]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">80</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="section">[tcp_81]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">81</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">8081</span></span><br></pre></td></tr></table></figure>

<p>éœ€è¦ä¿®æ”¹<code>server_addr</code>ä¸ºè¿œç¨‹<code>frps</code>æœåŠ¡å™¨çš„IPåœ°å€ï¼Œ<code>local_port</code>æ˜¯<code>NAT</code>è®¾å¤‡WebæœåŠ¡çš„ç«¯å£ï¼Œ<code>remote_port</code>æ˜¯æ˜ å°„åœ¨æœåŠ¡å™¨ä¸Šçš„ç«¯å£ã€‚ä»¥ä¸Šçš„é…ç½®æ–‡ä»¶åªæ¼”ç¤ºäº†<code>tcp</code>æœåŠ¡çš„ç©¿é€ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é…ç½®ã€‚æ¯”å¦‚å¯¹<code>ssh</code>ç«¯å£è¿›è¡Œè½¬å‘ã€‚<a target="_blank" rel="noopener" href="https://github.com/fatedier/frp#access-your-computer-in-lan-by-ssh">è¿™é‡Œ</a>æ˜¯å®˜æ–¹æä¾›çš„ä¾‹å­ã€‚</p>
<h3 id="å®‰å…¨éœ€æ±‚"><a href="#å®‰å…¨éœ€æ±‚" class="headerlink" title="å®‰å…¨éœ€æ±‚"></a>å®‰å…¨éœ€æ±‚</h3><p><code>frp</code>æä¾›äº†ä¸¤ç§å®¢æˆ·ç«¯è®¤è¯æ–¹å¼ï¼š<code>Tokenè®¤è¯</code>å’Œ<code>OIDCè®¤è¯</code>ã€‚</p>
<h4 id="Tokenè®¤è¯"><a href="#Tokenè®¤è¯" class="headerlink" title="Tokenè®¤è¯"></a>Tokenè®¤è¯</h4><p>åœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œä½¿ç”¨çš„å°±æ˜¯Tokenè®¤è¯ï¼Œéœ€è¦åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ä¸‹çš„<code>common</code>å—ä¸­é…ç½®<code>token = *å¯†é’¥*</code>å³å¯ã€‚</p>
<h4 id="OIDCè®¤è¯"><a href="#OIDCè®¤è¯" class="headerlink" title="OIDCè®¤è¯"></a>OIDCè®¤è¯</h4><p>ä½¿ç”¨<code>OIDCè®¤è¯</code>éœ€è¦åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ä¸‹çš„<code>common</code>å—ä¸­æŒ‡å®šè®¤è¯æ–¹å¼ä¸º<code>oidc</code>ã€‚</p>
<h5 id="frpsé…ç½®æ–‡ä»¶å‚è€ƒ"><a href="#frpsé…ç½®æ–‡ä»¶å‚è€ƒ" class="headerlink" title="frpsé…ç½®æ–‡ä»¶å‚è€ƒ"></a>frpsé…ç½®æ–‡ä»¶å‚è€ƒ</h5><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">authentication_method</span> = oidc</span><br><span class="line"><span class="attr">oidc_issuer</span> = https://example-oidc-issuer.com/</span><br><span class="line"><span class="attr">oidc_audience</span> = https://oidc-audience.com/.default</span><br></pre></td></tr></table></figure>

<h5 id="frpcé…ç½®æ–‡ä»¶å‚è€ƒ"><a href="#frpcé…ç½®æ–‡ä»¶å‚è€ƒ" class="headerlink" title="frpcé…ç½®æ–‡ä»¶å‚è€ƒ"></a>frpcé…ç½®æ–‡ä»¶å‚è€ƒ</h5><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">authentication_method</span> = oidc</span><br><span class="line"><span class="attr">oidc_client_id</span> = <span class="number">98692467</span>-<span class="number">37</span>de-<span class="number">409</span>a-<span class="number">9</span>fac-bb2585826f18 <span class="comment"># Replace with OIDC client ID</span></span><br><span class="line"><span class="attr">oidc_client_secret</span> = oidc_secret</span><br><span class="line"><span class="attr">oidc_audience</span> = https://oidc-audience.com/.default</span><br><span class="line"><span class="attr">oidc_token_endpoint_url</span> = https://example-oidc-endpoint.com/oauth2/v2.<span class="number">0</span>/token</span><br></pre></td></tr></table></figure>

<h5 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h5><table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>authentication_method</td>
<td>èº«ä»½éªŒè¯æ–¹å¼ï¼Œtoken æˆ– oidcï¼Œé»˜è®¤ä¸º tokenã€‚</td>
</tr>
<tr>
<td>authenticate_heartbeats</td>
<td>åœ¨æ¯ä¸€ä¸ªå¿ƒè·³åŒ…ä¸­é™„åŠ ä¸Šèº«ä»½è®¤è¯ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯æœåŠ¡ç«¯éœ€è¦ä¸€è‡´ã€‚</td>
</tr>
<tr>
<td>authenticate_new_work_conns</td>
<td>åœ¨æ¯æ¬¡åˆ›å»ºå·¥ä½œè¿æ¥æ—¶é™„åŠ ä¸Šèº«ä»½è®¤è¯ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯æœåŠ¡ç«¯éœ€è¦ä¸€è‡´ã€‚</td>
</tr>
</tbody></table>
<h3 id="frpä¸‹è½½"><a href="#frpä¸‹è½½" class="headerlink" title="frpä¸‹è½½"></a>frpä¸‹è½½</h3><p>å¯ä»¥åˆ°<code>frp</code><a target="_blank" rel="noopener" href="https://github.com/fatedier/frp/releases/">ç‰ˆæœ¬å‘å¸ƒé¡µä¸‹è½½</a>ï¼Œé€‰æ‹©å¹¶ä¸‹è½½é€‚åˆè‡ªå·±å¹³å°çš„ç‰ˆæœ¬ã€‚åœ¨ä¸‹è½½çš„å‹ç¼©åŒ…ä¸­åŒ…å«äº†æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä»¥<code>linux_amd64</code>ä¸ºä¾‹ï¼Œç›®å½•ç»“æ„ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ LICENSE</span><br><span class="line">â”œâ”€â”€ frpc</span><br><span class="line">â”œâ”€â”€ frpc.ini</span><br><span class="line">â”œâ”€â”€ frpc_full.ini</span><br><span class="line">â”œâ”€â”€ frps</span><br><span class="line">â”œâ”€â”€ frps.ini</span><br><span class="line">â””â”€â”€ frps_full.ini</span><br></pre></td></tr></table></figure>

<h2 id="å®¹å™¨ç¼–æ’"><a href="#å®¹å™¨ç¼–æ’" class="headerlink" title="å®¹å™¨ç¼–æ’"></a>å®¹å™¨ç¼–æ’</h2><p>æœ¬èŠ‚ä½¿ç”¨<code>docker-compose</code>ç¼–æ’<code>frps</code>å’Œ<code>nginx</code>ï¼Œå®Œæˆå¯¹æµé‡çš„è½¬å‘å’Œè¿‡æ»¤ã€‚</p>
<h3 id="æ–‡ä»¶ç»“æ„"><a href="#æ–‡ä»¶ç»“æ„" class="headerlink" title="æ–‡ä»¶ç»“æ„"></a>æ–‡ä»¶ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ docker-compose.yml</span><br><span class="line">â”œâ”€â”€ frps</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ Dockerfile</span><br><span class="line">â”‚Â Â  â””â”€â”€ conf</span><br><span class="line">â”‚Â Â      â””â”€â”€ frps.ini</span><br><span class="line">â””â”€â”€ nginx</span><br><span class="line"> Â Â  â”œâ”€â”€ Dockerfile</span><br><span class="line"> Â Â  â”œâ”€â”€ conf</span><br><span class="line"> Â Â  â”‚Â Â  â”œâ”€â”€ firewall_conf</span><br><span class="line"> Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ firewall.conf</span><br><span class="line"> Â Â  â”‚Â Â  â”œâ”€â”€ nginx.conf</span><br><span class="line"> Â Â  â”‚Â Â  â””â”€â”€ tcp_conf</span><br><span class="line"> Â Â  â”‚Â Â      â”œâ”€â”€ tcp7000.conf</span><br><span class="line"> Â Â  â”‚Â Â      â”œâ”€â”€ tcp8080.conf</span><br><span class="line"> Â Â  â”‚Â Â      â””â”€â”€ tcp8081.conf</span><br><span class="line"> Â Â  â”œâ”€â”€ logs</span><br><span class="line"> Â Â  â””â”€â”€ templates</span><br><span class="line"> Â Â      â””â”€â”€ index.html</span><br></pre></td></tr></table></figure>

<h3 id="docker-composeç¼–æ’æ–‡ä»¶"><a href="#docker-composeç¼–æ’æ–‡ä»¶" class="headerlink" title="docker-composeç¼–æ’æ–‡ä»¶"></a>docker-composeç¼–æ’æ–‡ä»¶</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.5&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">frps_app:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">frps_server</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./frps/conf:/etc/frp</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">./frps</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nginx_app:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">./nginx</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/logs:/var/nginx/logs</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;7000:7000&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8081:8081&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="frpså®¹å™¨é…ç½®"><a href="#frpså®¹å™¨é…ç½®" class="headerlink" title="frpså®¹å™¨é…ç½®"></a>frpså®¹å™¨é…ç½®</h3><h4 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h4><p>åœ¨<code>Dockerfile</code>ä¸­é…ç½®<code>frps</code>é•œåƒï¼Œ<code>conf/</code>æ–‡ä»¶å¤¹ä¸­æ”¾ç½®é…ç½®æ–‡ä»¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">frps/</span><br><span class="line">â”œâ”€â”€ Dockerfile</span><br><span class="line">â””â”€â”€ conf</span><br><span class="line">    â””â”€â”€ frps.ini</span><br></pre></td></tr></table></figure>

<h4 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h4><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> snowdreamtech/frps</span><br></pre></td></tr></table></figure>

<h3 id="nginxå®¹å™¨é…ç½®"><a href="#nginxå®¹å™¨é…ç½®" class="headerlink" title="nginxå®¹å™¨é…ç½®"></a>nginxå®¹å™¨é…ç½®</h3><p>Nginxæ˜¯ä¸€æ¬¾è½»é‡çº§çš„WebæœåŠ¡å™¨ã€åå‘ä»£ç†æœåŠ¡å™¨ï¼Œç”±äºå®ƒçš„å†…å­˜å ç”¨å°‘ï¼Œå¯åŠ¨æå¿«ï¼Œé«˜å¹¶å‘èƒ½åŠ›å¼ºï¼Œåœ¨äº’è”ç½‘é¡¹ç›®ä¸­å¹¿æ³›åº”ç”¨ã€‚</p>
<h4 id="ç›®å½•ç»“æ„-1"><a href="#ç›®å½•ç»“æ„-1" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">nginx/</span><br><span class="line">â”œâ”€â”€ Dockerfile</span><br><span class="line">â”œâ”€â”€ conf</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ firewall_conf</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ firewall.conf</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ nginx.conf</span><br><span class="line">â”‚Â Â  â””â”€â”€ tcp_conf</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ tcp7000.conf</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ tcp8080.conf</span><br><span class="line">â”‚Â Â      â””â”€â”€ tcp8081.conf</span><br><span class="line">â”œâ”€â”€ logs</span><br><span class="line">â””â”€â”€ templates</span><br><span class="line">    â””â”€â”€ index.html</span><br></pre></td></tr></table></figure>

<p><code>nginx</code>è¿™æœ¬æ–‡åœºæ™¯ä¸­é™¤äº†å¯¹æµé‡è¿›è¡Œè½¬å‘ï¼Œè¿˜åœ¨<code>80</code>ç«¯å£æä¾›äº†<code>html</code>æœåŠ¡ã€‚åœ¨<code>conf/</code>æ–‡ä»¶å¤¹ä¸­æ”¾ç½®äº†æµé‡è¿‡æ»¤å’Œè½¬å‘çš„é…ç½®æ–‡ä»¶ï¼Œæµé‡è¿‡æ»¤ç›®å‰åªå¯¹å›½å¤–æµé‡è¿›è¡Œäº†è¿‡æ»¤ã€‚</p>
<h4 id="ç¼–æ’åçš„ç½‘ç»œæ‹“æ‰‘"><a href="#ç¼–æ’åçš„ç½‘ç»œæ‹“æ‰‘" class="headerlink" title="ç¼–æ’åçš„ç½‘ç»œæ‹“æ‰‘"></a>ç¼–æ’åçš„ç½‘ç»œæ‹“æ‰‘</h4><p>ä¸‹å›¾æ˜¯ç»è¿‡å®¹å™¨ç¼–æ’åçš„ç½‘ç»œæ‹“æ‰‘ç»“æ„ã€‚</p>
<p><img src="https://raw.githubusercontent.com/focuseds/pics/main/img/202209-topological-structure-with-docker-compose.png" alt="å®¹å™¨ç¼–æ’åçš„æ‹“æ‰‘ç»“æ„"></p>
<p>å…¶ä¸­<code>172.13.0.0/24</code>æ®µæ˜¯<code>frps</code>å’Œ<code>nginx</code>ä¸¤ä¸ªå®¹å™¨æ‰€åœ¨ç½‘æ®µã€‚é€šè¿‡<code>docker-compose</code>ç«¯å£æ˜ å°„å°†é€šè¿‡<code>nginx</code>è½¬å‘çš„<code>frps</code>æœåŠ¡ç«¯å£å’Œå†…ç½‘æœåŠ¡å™¨æ˜ å°„åˆ°è¯¥æœåŠ¡å™¨ä¸Šçš„ä¸¤ä¸ªå†…ç½‘ç«¯å£æ˜ å°„åˆ°æ‹¥æœ‰ç‹¬ç«‹IPçš„äº‘ä¸»æœºä¸Šã€‚</p>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ports:</span><br><span class="line">    - <span class="string">&quot;7000:7000&quot;</span></span><br><span class="line">    - <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    - <span class="string">&quot;8081:8081&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="nginxé…ç½®æ–‡ä»¶"><a href="#nginxé…ç½®æ–‡ä»¶" class="headerlink" title="nginxé…ç½®æ–‡ä»¶"></a>nginxé…ç½®æ–‡ä»¶</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span> auto;</span><br><span class="line"> </span><br><span class="line"><span class="section">events</span> &#123; <span class="attribute">worker_connections</span> <span class="number">1024</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="section">stream</span> &#123;</span><br><span class="line">        <span class="attribute">log_format</span> proxy <span class="string">&#x27;<span class="variable">$remote_addr</span> [<span class="variable">$time_local</span>] &#x27;</span></span><br><span class="line">                    <span class="string">&#x27;<span class="variable">$protocol</span> <span class="variable">$status</span> <span class="variable">$bytes_sent</span> <span class="variable">$bytes_received</span> &#x27;</span></span><br><span class="line">                    <span class="string">&#x27;<span class="variable">$session_time</span> &quot;<span class="variable">$upstream_addr</span>&quot; &#x27;</span></span><br><span class="line">                    <span class="string">&#x27;&quot;<span class="variable">$upstream_bytes_sent</span>&quot; &quot;<span class="variable">$upstream_bytes_received</span>&quot; &quot;<span class="variable">$upstream_connect_time</span>&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">access_log</span> /var/nginx/logs/tcp-access.log proxy ;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">open_log_file_cache</span> <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è½¬å‘frpsæµé‡</span></span><br><span class="line">        <span class="attribute">include</span> tcp_conf/<span class="regexp">*.conf</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">tcp_nopush</span> 		<span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">autoindex</span> 	   <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">server_tokens</span>  <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">gzip</span>	<span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_min_length</span> <span class="number">1k</span>;</span><br><span class="line">    <span class="attribute">gzip_buffers</span> <span class="number">4</span> <span class="number">16k</span>;</span><br><span class="line">    <span class="attribute">gzip_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">    <span class="attribute">gzip_comp_level</span> <span class="number">4</span>;</span><br><span class="line">    <span class="attribute">gzip_types</span> text/plain application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png; </span><br><span class="line">	</span><br><span class="line">    <span class="comment"># å¯¹å›½å¤–æµé‡è¿›è¡Œè¿‡æ»¤</span></span><br><span class="line">	<span class="attribute">include</span> firewall_conf/firewall.conf;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span> localhost;</span><br><span class="line">        <span class="attribute">access_log</span> /var/nginx/logs/access-<span class="number">80</span>.log;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿‡æ»¤å¯èƒ½çš„çˆ¬è™«å®¢æˆ·ç«¯</span></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">	    	<span class="attribute">if</span> (<span class="variable">$http_user_agent</span> <span class="regexp">~* wget|curl|scrapy|okhttp|httpclient|java|python|go)</span> &#123;</span><br><span class="line">	        	<span class="attribute">return</span> <span class="number">444</span>;</span><br><span class="line">	    	&#125;</span><br><span class="line">        	<span class="attribute">root</span>   /var/www/static;</span><br><span class="line">        	<span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">	    	<span class="attribute">add_header</span> X-XSS-Protection <span class="string">&#x27;1; mode=block&#x27;</span>;</span><br><span class="line">	    	<span class="attribute">limit_except</span> GET &#123; <span class="attribute">deny</span> all; &#125;</span><br><span class="line">       	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="upstreamé…ç½®"><a href="#upstreamé…ç½®" class="headerlink" title="upstreamé…ç½®"></a>upstreamé…ç½®</h3><p>åœ¨<code>nginx</code>çš„é…ç½®æ–‡ä»¶ç›®å½•ä¸‹æ–°å»º<code>tcp_conf/</code>ï¼Œå¹¶ç¼–å†™éœ€è¦é…ç½®çš„<code>80</code>å’Œ<code>81</code>çš„é…ç½®æ–‡ä»¶ã€‚</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># frps7000ç«¯å£tcpè½¬å‘</span></span><br><span class="line"><span class="section">upstream</span> tcp7000 &#123;</span><br><span class="line">    <span class="attribute">server</span> frps_app:<span class="number">7000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">7000</span>;</span><br><span class="line">    <span class="attribute">proxy_connect_timeout</span> <span class="number">8s</span>;</span><br><span class="line">    <span class="attribute">proxy_timeout</span> <span class="number">24h</span>;</span><br><span class="line">    <span class="attribute">proxy_pass</span> tcp7000;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 8080ç«¯å£tcpè½¬å‘</span></span><br><span class="line"><span class="section">upstream</span> tcp8080 &#123;</span><br><span class="line">    <span class="attribute">server</span> frps_app:<span class="number">8080</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line">    <span class="attribute">proxy_connect_timeout</span> <span class="number">8s</span>;</span><br><span class="line">    <span class="attribute">proxy_timeout</span> <span class="number">24h</span>;</span><br><span class="line">    <span class="attribute">proxy_pass</span> tcp8080;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 81ç«¯å£tcpè½¬å‘</span></span><br><span class="line"><span class="section">upstream</span> tcp8081 &#123;</span><br><span class="line">    <span class="attribute">server</span> frps_app:<span class="number">8081</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8081</span>;</span><br><span class="line">    <span class="attribute">proxy_connect_timeout</span> <span class="number">8s</span>;</span><br><span class="line">    <span class="attribute">proxy_timeout</span> <span class="number">24h</span>;</span><br><span class="line">    <span class="attribute">proxy_pass</span> tcp8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Dockerfile-1"><a href="#Dockerfile-1" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> nginx</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> TimeZone=Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /etc/nginx/</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">cp</span> nginx.conf ./nginx.conf.bak</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./conf/nginx.conf ./</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">mkdir</span> tcp_conf</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">mkdir</span> firewall_conf</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./conf/tcp_conf/* ./tcp_conf/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./conf/firewall_conf/* ./firewall_conf/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">mkdir</span> -p /var/www/static</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /var/www/static</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./templates/index.html ./index.html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>, <span class="string">&quot;-g&quot;</span>, <span class="string">&quot;daemon off;&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">7000</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8081</span></span><br></pre></td></tr></table></figure>

<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>é¡¹ç›®å†™çš„æ¯”è¾ƒæ½¦è‰ï¼Œå¸Œæœ›å’Œå¤§å®¶å¤šäº¤æµï¼Œæ„Ÿè°¢ã€‚</p>
<p><img src="https://raw.githubusercontent.com/focuseds/pics/main/img/nat-project-running-example.png" alt="è¿è¡Œæˆªå›¾"></p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/fatedier/frp">frpæ–‡æ¡£</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/focuseds/NAT-traversal-server-with-nginx/">é¡¹ç›®åœ°å€</a></li>
</ol>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">é¦–é¡µ</a></li>
         
          <li><a href="/archives/">å½’æ¡£</a></li>
         
          <li><a href="/search/">æœç´¢</a></li>
         
          <li><a href="/about/">å…³äº</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">ä»‹ç»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E7%BB%93%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">æ‹“æ‰‘ç»“æ„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#frp%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE"><span class="toc-number">3.</span> <span class="toc-text">frpæœåŠ¡é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#frp%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">3.1.</span> <span class="toc-text">frpæœåŠ¡ç«¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#frpc"><span class="toc-number">3.2.</span> <span class="toc-text">frpc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E9%9C%80%E6%B1%82"><span class="toc-number">3.3.</span> <span class="toc-text">å®‰å…¨éœ€æ±‚</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Token%E8%AE%A4%E8%AF%81"><span class="toc-number">3.3.1.</span> <span class="toc-text">Tokenè®¤è¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OIDC%E8%AE%A4%E8%AF%81"><span class="toc-number">3.3.2.</span> <span class="toc-text">OIDCè®¤è¯</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#frps%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8F%82%E8%80%83"><span class="toc-number">3.3.2.1.</span> <span class="toc-text">frpsé…ç½®æ–‡ä»¶å‚è€ƒ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#frpc%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8F%82%E8%80%83"><span class="toc-number">3.3.2.2.</span> <span class="toc-text">frpcé…ç½®æ–‡ä»¶å‚è€ƒ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="toc-number">3.3.2.3.</span> <span class="toc-text">å‚æ•°è¯´æ˜</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#frp%E4%B8%8B%E8%BD%BD"><span class="toc-number">3.4.</span> <span class="toc-text">frpä¸‹è½½</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92"><span class="toc-number">4.</span> <span class="toc-text">å®¹å™¨ç¼–æ’</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">4.1.</span> <span class="toc-text">æ–‡ä»¶ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-compose%E7%BC%96%E6%8E%92%E6%96%87%E4%BB%B6"><span class="toc-number">4.2.</span> <span class="toc-text">docker-composeç¼–æ’æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#frps%E5%AE%B9%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">4.3.</span> <span class="toc-text">frpså®¹å™¨é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">4.3.1.</span> <span class="toc-text">ç›®å½•ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Dockerfile"><span class="toc-number">4.3.2.</span> <span class="toc-text">Dockerfile</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nginx%E5%AE%B9%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">4.4.</span> <span class="toc-text">nginxå®¹å™¨é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84-1"><span class="toc-number">4.4.1.</span> <span class="toc-text">ç›®å½•ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E6%8E%92%E5%90%8E%E7%9A%84%E7%BD%91%E7%BB%9C%E6%8B%93%E6%89%91"><span class="toc-number">4.4.2.</span> <span class="toc-text">ç¼–æ’åçš„ç½‘ç»œæ‹“æ‰‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">4.4.3.</span> <span class="toc-text">nginxé…ç½®æ–‡ä»¶</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#upstream%E9%85%8D%E7%BD%AE"><span class="toc-number">4.5.</span> <span class="toc-text">upstreamé…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dockerfile-1"><span class="toc-number">4.6.</span> <span class="toc-text">Dockerfile</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-number">5.</span> <span class="toc-text">ç»“è¯­</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-number">6.</span> <span class="toc-text">å‚è€ƒé“¾æ¥</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/&text=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/&title=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/&is_video=false&description=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡&body=Check out this article: https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/&title=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/&title=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/&title=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/&title=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/&name=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://focuseds.github.io/nat-traversal-with-nginx-docker-compose/&t=ä½¿ç”¨nginxè½¬å‘å†…ç½‘ç©¿é€æœåŠ¡ç«¯æµé‡"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> èœå•</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> ç›®å½•</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> åˆ†äº«</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> è¿”å›é¡¶éƒ¨</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
      
        
          2018-2022
            Focuseds
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        
          <!--
       -->
          <li><a href="/">
              é¦–é¡µ
            </a></li>
          <!--
     -->
          
          <!--
       -->
          <li><a href="/archives/">
              å½’æ¡£
            </a></li>
          <!--
     -->
          
          <!--
       -->
          <li><a href="/search/">
              æœç´¢
            </a></li>
          <!--
     -->
          
          <!--
       -->
          <li><a href="/about/">
              å…³äº
            </a></li>
          <!--
     -->
          
            
              <!-- ä¸è’œå­ç»Ÿè®¡ -->
              <span id="busuanzi_container_site_pv">
                æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
              </span>
              <span class="post-meta-divider">|</span>
              <span id="busuanzi_container_site_uv" style='display:none'>
                æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äºº
              </span>
              <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
              
      </ul>
    </nav>
  </div>
</footer>
    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"å¤åˆ¶åˆ°ç²˜è´´æ¿ï¼\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "å¤åˆ¶æˆåŠŸï¼");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FN5YNJ7DRE"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FN5YNJ7DRE');
    </script>

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
